<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="./src/styles/index.scss" />
    <title>Document</title>
  </head>
  
  <body>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="https://d3js.org/d3-transition.v1.min.js"></script>
    <script src="./dist/main.js"></script>
    <header>Langauges of NYC</header>
    <div class="map"></div>
    <h2 class="languages"></h2>
    <div class="words-yo"></div>
    <style>


      .languages {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 9em;
        left: .7em;
        width: 300px;
        height: 400px;
      }

      header {
        height: 70px;
        justify-content: center;
        display: flex;
        align-items: center;
        font-size: 30px;
      }
    </style>


    <script>
     

      
        let width = 1250,
            height = 800;
        let svg = d3.select(".map").append("svg")
            .attr("width", width)
            .attr("height", height);

            let g = svg.append("g");
            g.append("rect")
              .attr("x", 10)
              .attr("y", 10)
              .attr("width", 300)
              .attr("height", 450)
              .attr("stroke", "rgb(107, 174, 214)")
              .attr("fill", "white")
              g.append("rect")
              .attr("x", 500)
              .attr("y", 500)
              .attr("width", 500)
              .attr("height", 500)
              .attr("stroke", "rgb(107, 174, 214)")
              .attr("fill", "white")
              
            
            d3.json("borough_boundaries.geojson", function (boroughs) {
              let projection = d3.geoMercator()
                .center([-73.94, 40.70])
                .scale(80000)
                .translate([(width) / 2, (height) / 2]);

              const color = d3.scaleOrdinal(d3.schemeCategory20c.slice(1, 4));
              
              let geoPath = d3.geoPath()
              .projection(projection);
              g.selectAll("path")
              .data(boroughs.features)
              .enter()
              .append("path")
              .attr("fill", (d, i) => color(i))
              .attr("stroke", "#000")
              .attr("stroke-width", "1.5px")
              .attr("d", geoPath)
              .on("mouseover", mouseOverHandler)
              .on("mouseout", mouseOutHandler)
              .on("click", clickHandler);
              g.append("g")
                .selectAll("text")
                .data(boroughs.features)
                .enter()
                .append("text")
                .attr("class", "unselected")
                .attr("transform", d => `translate(${geoPath.centroid(d)})`)
                .attr("text-anchor", "middle")
                .attr("font-size", 15)
                .text(d => d.properties.boro_name);
                
                const hoverColor = "red"
                let boroLanguages;
                d3.json("src/languages/languages.json", languages => {
                  boroLanguages = languages;
                })
                function mouseOverHandler(d, i) {
                  d3.select(this).attr("fill", hoverColor)
                }
                function mouseOutHandler(d, i) {
                  d3.select(this).attr("fill", color(i))
                }
                function clickHandler(d, i) { 
                  const boro = d.properties.boro_name
                  const languages = boroLanguages[boro]
                  const langs = Object.keys(languages)
                  const nums = Object.values(languages)
                  const displayText = `${(langs[0])}: ${ nums[0] } \n 
                    ${ (langs[1]) }: ${ nums[1] } \n 
                    ${ (langs[2]) }: ${ nums[2] }`
                  
                function languageClick(d, i) {
                  const language = d
                  let words;
                  d3.json(`src/languages/${d.toLowerCase()}.json`, data => {
                    d3.select(".words-yo").selectAll("text").remove()
                    let words = d3.select(".words-yo")
                    .selectAll("text")
                    .data(data)
                    .enter()
                    .append("text")
                    .text(function (d) {return `${d.word}: ${d.translation}, `})
                    // let translations = d3.select(".words-yo")
                    // .data(Object.values(data.words))
                    // .enter()
                    // .append("text")

                    // d3.select(".words-yo").selectAll("text").remove()
                    // d3.select(".words-yo")
                    // .append("text")
                    // select individual word/text element
                    // translations.text(Object.values(data.words))
                    // .selectAll("p").data()
                    .enter()
                    // .append("p")
                    .attr("font-size", 15)
                    .attr("position", "absolute")
                    .attr("top", "25em")
                    .attr("left", "25em")
                  })
                  
                }
                  
                  // console.log(langs)
                  // console.log(nums)
                  // console.log(languages)

                  d3.select(".languages")
                  .selectAll("input").remove()
                  d3.select(".languages")
                  .selectAll("input")
                  .data(Object.keys(languages))
                  .enter()
                  .append("input")
                  .attr("type", "button")
                  .attr("class", "button")
                  .attr("value", (d) => { return d; })
                  .style("min-height", "75px")
                  .on("click", (languageClick))
                  
      }
            });

            </script>
  </body>
  </html>
  